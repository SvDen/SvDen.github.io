"use strict";function ToDoList(t){function e(){var t=void 0;try{t=JSON.parse(h.getItem("todo-list"))}catch(e){t=void 0,console.log("Error in localStorage file: "+e.message)}b=t||{},o();for(var n in b)l(n,b[n].task,b[n].important,b[n].completed)}function o(){h.setItem("todo-list",JSON.stringify(b)),0==Object.keys(b).length?E.classList.add("hidden"):E.classList.remove("hidden")}function n(t){var e=t.closest("li"),n=e.getAttribute("data-id");e.remove(),delete b[n],o()}function i(t){function e(n){n.target!=s&&(t.textContent=s.value,b[a].task=t.textContent,document.removeEventListener("click",e),s.remove(),k=!1,t.classList.remove("hidden"),o())}function n(n){var i=n.which;if(13==i)t.textContent=s.value,b[a].task=t.textContent;else if(27!=i)return;document.removeEventListener("click",e),s.remove(),k=!1,t.classList.remove("hidden"),o()}if(!k){k=!0,t.classList.add("hidden");var i=t.closest("li"),a=i.getAttribute("data-id"),s=document.createElement("div");s.innerHTML='<input type="text" class="todo-list-edit form-control">',s=s.firstChild,s.value=t.textContent,i.appendChild(s),s.focus(),event.stopImmediatePropagation(),document.addEventListener("click",e),document.addEventListener("keydown",n)}}function a(t){var e=t.closest("li"),n=e.getAttribute("data-id");t.classList.toggle("label-danger"),t.classList.toggle("label-default"),b[n].important=!b[n].important,o()}function s(t){var e=t.closest("li"),n=e.getAttribute("data-id");e.classList.toggle("completed"),b[n].completed=!b[n].completed,o()}function d(t,e,n){var i=Math.random(),a={task:t,important:e,completed:n};b[i]=a,l(i,t,e,n),L.focus(),o()}function l(t,e,o,n){var i=document.createElement("li");i.classList.add("list-group-item","todo-item"),i.setAttribute("data-id",t);var a=void 0;a=o===!0?"label-danger":"label-default";var s='<label class="complete-container">\n                            <input type="checkbox" class="complete">\n                            <span class="todo-item-icon"></span>\n                        </label>\n                        <span class="todo-item-label label '+a+'">!</span>\n                        <span class="todo-item-text">'+e+'</span>\n                        <span class="todo-item-close text-danger pull-right">&#10006;</span>';n&&i.classList.add("completed"),i.innerHTML=s,p.appendChild(i)}function c(){var t=p.getElementsByTagName("li");Array.from(t).forEach(function(t){return t.remove()})}function r(t,e,n){"down"==n?e.parentElement.insertBefore(t,e.nextSibling):e.parentElement.insertBefore(t,e),x.y=B.y;var i=e.getAttribute("data-id"),a=t.getAttribute("data-id"),s=void 0;s=b[i],b[i]=b[a],b[a]=s,t.setAttribute("data-id",i),e.setAttribute("data-id",a),o()}function m(t){B={y:t.pageY},Math.abs(x.y-B.y)<10||(A.classList.add("todo-element-dragging"),document.body.classList.add("todo-dragging"),t.target.closest("li")&&(t.target.closest("li")!==w&&(w=t.target.closest("li"),C=w.getBoundingClientRect().top+window.pageYOffset+w.offsetHeight/2),A!=w&&(x.y<B.y&&B.y>C?r(A,w,"down"):x.y>B.y&&B.y<C&&r(A,w,"up"))))}function u(){document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",u),A.classList.remove("todo-element-dragging"),document.body.classList.remove("todo-dragging")}var v=t.id,g=document.getElementById(v),p=document.getElementById("todo-list-group"),f=(g.getElementsByTagName("form")[0],document.getElementById("todo-submit")),L=document.getElementById("todo-input"),y=document.getElementById("todo-important"),E=document.getElementById("todo-filters"),b=void 0,h=localStorage,k=!1;e(),p.addEventListener("click",function(t){var e=t.target;e.classList.contains("todo-item-close")&&n(e),e.classList.contains("todo-item-label")&&a(e),e.classList.contains("todo-item-icon")&&s(e.parentElement.getElementsByTagName("input")[0])}),p.addEventListener("dblclick",function(t){var e=t.target;e.classList.contains("todo-item-text")&&i(e)}),f.addEventListener("click",function(t){var e=L.value;return""==e?!1:(d(e,y.checked,!1),L.value="",y.checked=!1,void t.preventDefault())}),E.addEventListener("click",function(t){var e=t.target;if(e.classList.contains("label")){var o=E.getElementsByTagName("span");if(Array.from(o).forEach(function(t){return t.classList.remove("active")}),e.classList.add("active"),c(),e.classList.contains("todo-all"))for(var n in b)l(n,b[n].task,b[n].important,b[n].completed);else if(e.classList.contains("todo-active"))for(var n in b)b[n].completed||l(n,b[n].task,b[n].important,b[n].completed);else if(e.classList.contains("todo-completed"))for(var n in b)b[n].completed&&l(n,b[n].task,b[n].important,b[n].completed);else if(e.classList.contains("todo-important"))for(var n in b)b[n].important&&l(n,b[n].task,b[n].important,b[n].completed);else;}});var B=void 0,x=void 0,A=void 0,w=void 0,C=void 0;p.addEventListener("mousedown",function(t){w=A=t.target.closest("li"),"LI"!==A.closest("li").tagName||1!==t.which||A.closest("ul").getElementsByClassName("todo-list-edit")[0]||(x={y:t.pageY},document.addEventListener("mousemove",m),document.addEventListener("mouseup",u))}),g.addEventListener("mousedown",function(t){t.target.closest("input")||t.preventDefault()})}var list=new ToDoList({id:"todo-list"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJUb0RvTGlzdCIsIm9wdGlvbnMiLCJsb2FkRnJvbUxvY2FsU3RvcmFnZSIsInBhcnNlZCIsInVuZGVmaW5lZCIsIkpTT04iLCJwYXJzZSIsInN0b3JhZ2UiLCJnZXRJdGVtIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwibG9jYWwiLCJ1cGRhdGVMb2NhbFN0b3JhZ2UiLCJrZXkiLCJhZGRUYXNrIiwidGFzayIsImltcG9ydGFudCIsImNvbXBsZXRlZCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiZmlsdGVycyIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsImRlbGV0ZVRhc2siLCJ0YXJnZXQiLCJsaSIsImNsb3Nlc3QiLCJpZCIsImdldEF0dHJpYnV0ZSIsImVkaXRUYXNrIiwic3RvcEVkaXRpbmdNb3VzZSIsImlucHV0IiwidGV4dENvbnRlbnQiLCJ2YWx1ZSIsImRvY3VtZW50IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImVkaXRpbmdOb3ciLCJzdG9wRWRpdGluZ0tleSIsIndoaWNoIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImZpcnN0Q2hpbGQiLCJhcHBlbmRDaGlsZCIsImZvY3VzIiwiZXZlbnQiLCJzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24iLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlSW1wb3J0YW50IiwidG9nZ2xlIiwiY29tcGxldGVUYXNrIiwibmV3VGFzayIsIk1hdGgiLCJyYW5kb20iLCJvYmoiLCJzdHJpbmciLCJzZXRBdHRyaWJ1dGUiLCJkYW5nZXIiLCJodG1sIiwibGlzdCIsImNsZWFyTGlzdCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiQXJyYXkiLCJmcm9tIiwiZm9yRWFjaCIsImVsZW0iLCJjaGFuZ2VFbGVtZW50cyIsImRyYWdnaW5nIiwiZGlyZWN0aW9uIiwicGFyZW50RWxlbWVudCIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwic3RhcnRDb29yZHMiLCJ5IiwiY3VyQ29vcmRzIiwidGFyZ2V0SUQiLCJkcmFnZ2luZ0lEIiwidGVtcCIsImRyYWdNb3ZlIiwicGFnZVkiLCJhYnMiLCJkcmFnZ2luZ0VsZW1lbnQiLCJib2R5IiwiY3VyVGFyZ2V0IiwiY3VyVGFyZ2V0RXF1YXRvciIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsIndpbmRvdyIsInBhZ2VZT2Zmc2V0Iiwib2Zmc2V0SGVpZ2h0IiwiZHJhZ0VuZCIsImdldEVsZW1lbnRCeUlkIiwiYWRkQnV0dG9uIiwibG9jYWxTdG9yYWdlIiwiY29udGFpbnMiLCJ0ZXh0IiwiY2hlY2tlZCIsInByZXZlbnREZWZhdWx0IiwiZmlsdGVyRWxlbWVudHMiLCJ0YWdOYW1lIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxTQUFTQSxVQUFTQyxHQW1CZCxRQUFTQyxLQUNMLEdBQUlDLEdBQUFDLE1BRUosS0FDSUQsRUFBU0UsS0FBS0MsTUFBTUMsRUFBUUMsUUFBUSxjQUN0QyxNQUFPQyxHQUNMTixFQUFTQyxPQUNUTSxRQUFRQyxJQUFSLCtCQUEyQ0YsRUFBRUcsU0FFakRDLEVBQVFWLE1BVG9CVyxHQWdCNUIsS0FBSyxHQUFJQyxLQUFPRixHQUNaRyxFQUFRRCxFQUFLRixFQUFNRSxHQUFLRSxLQUFNSixFQUFNRSxHQUFLRyxVQUFXTCxFQUFNRSxHQUFLSSxXQUl2RSxRQUFTTCxLQUNMUCxFQUFRYSxRQUFRLFlBQVlmLEtBQUtnQixVQUFVUixJQUdWLEdBQTdCUyxPQUFPQyxLQUFLVixHQUFPVyxPQUNuQkMsRUFBUUMsVUFBVUMsSUFBSSxVQUV0QkYsRUFBUUMsVUFBVUUsT0FBTyxVQS9DVixRQXNEZEMsR0FBV0MsR0FDaEIsR0FBSUMsR0FBS0QsRUFBT0UsUUFBUSxNQUNwQkMsRUFBS0YsRUFBR0csYUFBYSxVQUV6QkgsR0FBR0gsZUFDSWYsR0FBTW9CLEdBQ2JuQixJQUdKLFFBQVNxQixHQUFTTCxHQWVkLFFB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dXNlIHN0cmljdCc7XHJcblxyXG5mdW5jdGlvbiBUb0RvTGlzdChvcHRpb25zKSB7XHJcbiAgICBjb25zdCBpZCA9IG9wdGlvbnMuaWQsXHJcbiAgICAgICAgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSxcclxuICAgICAgICBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tbGlzdC1ncm91cCcpLFxyXG4gICAgICAgIGZvcm0gPSBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmb3JtJylbMF0sXHJcbiAgICAgICAgYWRkQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tc3VibWl0JyksXHJcbiAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1pbnB1dCcpLFxyXG4gICAgICAgIGltcG9ydGFudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLWltcG9ydGFudCcpLFxyXG4gICAgICAgIGZpbHRlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1maWx0ZXJzJyk7XHJcblxyXG4gICAgbGV0IGxvY2FsLFxyXG4gICAgICAgIHN0b3JhZ2UgPSBsb2NhbFN0b3JhZ2UsXHJcbiAgICAgICAgZWRpdGluZ05vdyA9IGZhbHNlO1xyXG5cclxuXHJcbiAgICAvKioqIFNUT1JBR0UgKioqL1xyXG5cclxuICAgIGxvYWRGcm9tTG9jYWxTdG9yYWdlKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gbG9hZEZyb21Mb2NhbFN0b3JhZ2UoKSB7XHJcbiAgICAgICAgbGV0IHBhcnNlZDtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcGFyc2VkID0gSlNPTi5wYXJzZShzdG9yYWdlLmdldEl0ZW0oJ3RvZG8tbGlzdCcpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHBhcnNlZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYEVycm9yIGluIGxvY2FsU3RvcmFnZSBmaWxlOiAke2UubWVzc2FnZX1gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9jYWwgPSBwYXJzZWQgfHwge307XHJcblxyXG4gICAgICAgIC8vIHVwZGF0ZSBkb2VzIDIgdGFza3M6XHJcbiAgICAgICAgLy8gYSkgcmVmcmVzaCB0aGUgTFNcclxuICAgICAgICAvLyDQsSkgY2hlY2sgdGhlIGZpbHRlciB2aXNpYmlsaXR5XHJcbiAgICAgICAgdXBkYXRlTG9jYWxTdG9yYWdlKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiBsb2NhbCkge1xyXG4gICAgICAgICAgICBhZGRUYXNrKGtleSwgbG9jYWxba2V5XS50YXNrLCBsb2NhbFtrZXldLmltcG9ydGFudCwgbG9jYWxba2V5XS5jb21wbGV0ZWQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsU3RvcmFnZSgpIHtcclxuICAgICAgICBzdG9yYWdlLnNldEl0ZW0oJ3RvZG8tbGlzdCcsSlNPTi5zdHJpbmdpZnkobG9jYWwpKTtcclxuXHJcbiAgICAgICAgLy8gY2hhbmdlIGZpbHRlciB2aXNpYmlsaXR5XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGxvY2FsKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICBmaWx0ZXJzLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZpbHRlcnMuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKioqIFdPUktJTkcgV0lUSCBUQVNLUyAqKiovXHJcblxyXG4gICAgZnVuY3Rpb24gZGVsZXRlVGFzayh0YXJnZXQpIHtcclxuICAgICAgICBsZXQgbGkgPSB0YXJnZXQuY2xvc2VzdCgnbGknKSxcclxuICAgICAgICAgICAgaWQgPSBsaS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcclxuXHJcbiAgICAgICAgbGkucmVtb3ZlKCk7XHJcbiAgICAgICAgZGVsZXRlIGxvY2FsW2lkXTtcclxuICAgICAgICB1cGRhdGVMb2NhbFN0b3JhZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBlZGl0VGFzayh0YXJnZXQpIHtcclxuICAgICAgICBpZiAoZWRpdGluZ05vdykgcmV0dXJuOyAvLyBjaGVjayBpZiBzb21lIGZpZWxkIGlzIGVkaXRpbmcgbm93XHJcbiAgICAgICAgZWRpdGluZ05vdyA9IHRydWU7XHJcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICBsZXQgbGkgPSB0YXJnZXQuY2xvc2VzdCgnbGknKSxcclxuICAgICAgICAgICAgaWQgPSBsaS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSxcclxuICAgICAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHJcbiAgICAgICAgaW5wdXQuaW5uZXJIVE1MID0gJzxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwidG9kby1saXN0LWVkaXQgZm9ybS1jb250cm9sXCI+JztcclxuICAgICAgICBpbnB1dCA9IGlucHV0LmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSB0YXJnZXQudGV4dENvbnRlbnQ7XHJcbiAgICAgICAgbGkuYXBwZW5kQ2hpbGQoaW5wdXQpO1xyXG4gICAgICAgIGlucHV0LmZvY3VzKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BFZGl0aW5nTW91c2UoZSkge1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQgPT0gaW5wdXQpIHJldHVybjtcclxuICAgICAgICAgICAgdGFyZ2V0LnRleHRDb250ZW50ID0gaW5wdXQudmFsdWU7XHJcbiAgICAgICAgICAgIGxvY2FsW2lkXS50YXNrID0gdGFyZ2V0LnRleHRDb250ZW50O1xyXG5cclxuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9wRWRpdGluZ01vdXNlKTtcclxuICAgICAgICAgICAgaW5wdXQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIGVkaXRpbmdOb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICB1cGRhdGVMb2NhbFN0b3JhZ2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BFZGl0aW5nS2V5KGUpIHtcclxuICAgICAgICAgICAgbGV0IGtleSA9IGUud2hpY2g7XHJcblxyXG4gICAgICAgICAgICBpZiAoa2V5ID09IDEzKSB7IC8vICdlbnRlcidcclxuICAgICAgICAgICAgICAgIHRhcmdldC50ZXh0Q29udGVudCA9IGlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxbaWRdLnRhc2sgPSB0YXJnZXQudGV4dENvbnRlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5ID09IDI3KSB7IC8vICdlc2MnXHJcbiAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nIGhlcmUgOi0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RvcEVkaXRpbmdNb3VzZSk7XHJcbiAgICAgICAgICAgIGlucHV0LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBlZGl0aW5nTm93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgdXBkYXRlTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9wRWRpdGluZ01vdXNlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgc3RvcEVkaXRpbmdLZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRvZ2dsZUltcG9ydGFudCh0YXJnZXQpIHtcclxuICAgICAgICBsZXQgbGkgPSB0YXJnZXQuY2xvc2VzdCgnbGknKSxcclxuICAgICAgICAgICAgaWQgPSBsaS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcclxuXHJcbiAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoJ2xhYmVsLWRhbmdlcicpO1xyXG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdsYWJlbC1kZWZhdWx0Jyk7XHJcblxyXG4gICAgICAgIGxvY2FsW2lkXS5pbXBvcnRhbnQgPSAhbG9jYWxbaWRdLmltcG9ydGFudDtcclxuICAgICAgICB1cGRhdGVMb2NhbFN0b3JhZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjb21wbGV0ZVRhc2sodGFyZ2V0KSB7XHJcbiAgICAgICAgbGV0IGxpID0gdGFyZ2V0LmNsb3Nlc3QoJ2xpJyksXHJcbiAgICAgICAgICAgIGlkID0gbGkuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XHJcblxyXG4gICAgICAgIGxpLmNsYXNzTGlzdC50b2dnbGUoJ2NvbXBsZXRlZCcpO1xyXG4gICAgICAgIGxvY2FsW2lkXS5jb21wbGV0ZWQgPSAhbG9jYWxbaWRdLmNvbXBsZXRlZDtcclxuICAgICAgICB1cGRhdGVMb2NhbFN0b3JhZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1pdGVtLWNsb3NlJykpIGRlbGV0ZVRhc2sodGFyZ2V0KTtcclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1pdGVtLWxhYmVsJykpIHRvZ2dsZUltcG9ydGFudCh0YXJnZXQpO1xyXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gY2F0Y2ggdGhlIElOUFVUIGV4YWN0bHlcclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1pdGVtLWljb24nKSkgY29tcGxldGVUYXNrKHRhcmdldC5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpWzBdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGxpc3QuYWRkRXZlbnRMaXN0ZW5lcignZGJsY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0b2RvLWl0ZW0tdGV4dCcpKSBlZGl0VGFzayh0YXJnZXQpO1xyXG4gICAgfSlcclxuXHJcblxyXG4gICAgLyoqKiBBRERJTkcgTkVXIFRBU0tTICoqKi9cclxuXHJcbiAgICBmdW5jdGlvbiBuZXdUYXNrKHRhc2ssIGltcG9ydGFudCwgY29tcGxldGVkKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGxvY2FsIHN0b3JhZ2Ugb2JqZWN0XHJcbiAgICAgICAgbGV0IGlkID0gTWF0aC5yYW5kb20oKTtcclxuXHJcbiAgICAgICAgbGV0IG9iaiA9IHtcclxuICAgICAgICAgICAgdGFzayxcclxuICAgICAgICAgICAgaW1wb3J0YW50LFxyXG4gICAgICAgICAgICBjb21wbGV0ZWRcclxuICAgICAgICB9O1xyXG4gICAgICAgIGxvY2FsW2lkXSA9IG9iajtcclxuXHJcbiAgICAgICAgYWRkVGFzayhpZCwgdGFzaywgaW1wb3J0YW50LCBjb21wbGV0ZWQpO1xyXG5cclxuICAgICAgICBpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIHVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFkZFRhc2soaWQsIHN0cmluZywgaW1wb3J0YW50LCBjb21wbGV0ZWQpIHtcclxuICAgICAgICBsZXQgdGFzayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgICAgdGFzay5jbGFzc0xpc3QuYWRkKCdsaXN0LWdyb3VwLWl0ZW0nLCAndG9kby1pdGVtJyk7XHJcbiAgICAgICAgdGFzay5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpZCk7XHJcblxyXG4gICAgICAgIGxldCBkYW5nZXI7XHJcbiAgICAgICAgKGltcG9ydGFudCA9PT0gdHJ1ZSkgPyBkYW5nZXIgPSAnbGFiZWwtZGFuZ2VyJyA6IGRhbmdlciA9ICdsYWJlbC1kZWZhdWx0JztcclxuXHJcbiAgICAgICAgbGV0IGh0bWwgPSBgPGxhYmVsIGNsYXNzPVwiY29tcGxldGUtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgY2xhc3M9XCJjb21wbGV0ZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b2RvLWl0ZW0taWNvblwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b2RvLWl0ZW0tbGFiZWwgbGFiZWwgJHtkYW5nZXJ9XCI+ITwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b2RvLWl0ZW0tdGV4dFwiPiR7c3RyaW5nfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b2RvLWl0ZW0tY2xvc2UgdGV4dC1kYW5nZXIgcHVsbC1yaWdodFwiPiYjMTAwMDY7PC9zcGFuPmBcclxuXHJcbiAgICAgICAgaWYgKGNvbXBsZXRlZCkgdGFzay5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcclxuICAgICAgICB0YXNrLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICAgICAgbGlzdC5hcHBlbmRDaGlsZCh0YXNrKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgbGV0IHRleHQgPSBpbnB1dC52YWx1ZTtcclxuICAgICAgICBpZiAodGV4dCA9PSAnJykgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIG5ld1Rhc2sodGV4dCwgaW1wb3J0YW50LmNoZWNrZWQsIGZhbHNlKTtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgICAgIGltcG9ydGFudC5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIC8qKiogRklMVEVSUyAqKiovXHJcblxyXG4gICAgZnVuY3Rpb24gY2xlYXJMaXN0KCkge1xyXG4gICAgICAgIGxldCBsaSA9IGxpc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xpJyk7XHJcbiAgICAgICAgQXJyYXkuZnJvbShsaSkuZm9yRWFjaChlbGVtID0+IGVsZW0ucmVtb3ZlKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbHRlcnMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbGFiZWwnKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAvLyBjaGFuZ2luZyBjbGFzc2VzXHJcbiAgICAgICAgbGV0IGZpbHRlckVsZW1lbnRzID0gZmlsdGVycy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3BhbicpO1xyXG4gICAgICAgIEFycmF5LmZyb20oZmlsdGVyRWxlbWVudHMpLmZvckVhY2goZWxlbSA9PiBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTtcclxuICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblxyXG4gICAgICAgIGNsZWFyTGlzdCgpO1xyXG5cclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1hbGwnKSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbG9jYWwpIHtcclxuICAgICAgICAgICAgICAgIGFkZFRhc2soa2V5LCBsb2NhbFtrZXldLnRhc2ssIGxvY2FsW2tleV0uaW1wb3J0YW50LCBsb2NhbFtrZXldLmNvbXBsZXRlZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1hY3RpdmUnKSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbG9jYWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbG9jYWxba2V5XS5jb21wbGV0ZWQpIGFkZFRhc2soa2V5LCBsb2NhbFtrZXldLnRhc2ssIGxvY2FsW2tleV0uaW1wb3J0YW50LCBsb2NhbFtrZXldLmNvbXBsZXRlZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndG9kby1jb21wbGV0ZWQnKSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gbG9jYWwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsb2NhbFtrZXldLmNvbXBsZXRlZCkgYWRkVGFzayhrZXksIGxvY2FsW2tleV0udGFzaywgbG9jYWxba2V5XS5pbXBvcnRhbnQsIGxvY2FsW2tleV0uY29tcGxldGVkKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0b2RvLWltcG9ydGFudCcpKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBsb2NhbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvY2FsW2tleV0uaW1wb3J0YW50KSBhZGRUYXNrKGtleSwgbG9jYWxba2V5XS50YXNrLCBsb2NhbFtrZXldLmltcG9ydGFudCwgbG9jYWxba2V5XS5jb21wbGV0ZWQpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAvKioqIERSQUcmRFJPUCAqKiovXHJcblxyXG4gICAgbGV0IGN1ckNvb3JkcyxcclxuICAgICAgICBzdGFydENvb3JkcyxcclxuICAgICAgICBkcmFnZ2luZ0VsZW1lbnQsXHJcbiAgICAgICAgY3VyVGFyZ2V0LFxyXG4gICAgICAgIGN1clRhcmdldEVxdWF0b3I7IC8vIGhvcml6b250YWwgbWlkZGxlIGxpbmUgb2YgdGhlIGV2ZW50IG9iamVjdCAodGFyZ2V0KVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoYW5nZUVsZW1lbnRzKGRyYWdnaW5nLCB0YXJnZXQsIGRpcmVjdGlvbikge1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ2Rvd24nKSB7XHJcbiAgICAgICAgICAgIHRhcmdldC5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShkcmFnZ2luZywgdGFyZ2V0Lm5leHRTaWJsaW5nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZHJhZ2dpbmcsIHRhcmdldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXJ0Q29vcmRzLnkgPSBjdXJDb29yZHMueTtcclxuXHJcbiAgICAgICAgbGV0IHRhcmdldElEID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpLFxyXG4gICAgICAgICAgICBkcmFnZ2luZ0lEID0gZHJhZ2dpbmcuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyksXHJcbiAgICAgICAgICAgIHRlbXA7XHJcblxyXG4gICAgICAgIC8vIGNoYW5nZSB0aGUgb2JqZWN0J3MgZGF0YSAuLi5cclxuICAgICAgICB0ZW1wID0gbG9jYWxbdGFyZ2V0SURdO1xyXG4gICAgICAgIGxvY2FsW3RhcmdldElEXSA9IGxvY2FsW2RyYWdnaW5nSURdO1xyXG4gICAgICAgIGxvY2FsW2RyYWdnaW5nSURdID0gdGVtcDtcclxuXHJcbiAgICAgICAgLy8gLi4uIGFuZCBJRCdzXHJcbiAgICAgICAgZHJhZ2dpbmcuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgdGFyZ2V0SUQpO1xyXG4gICAgICAgIHRhcmdldC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBkcmFnZ2luZ0lEKTtcclxuXHJcbiAgICAgICAgdXBkYXRlTG9jYWxTdG9yYWdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ01vdmUoZSkge1xyXG5cclxuICAgICAgICBjdXJDb29yZHMgPSB7XHJcbiAgICAgICAgICAgIHk6IGUucGFnZVlcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIGlmIHRoZXJlIHdhcyBtaXNzIGNsaWNrID0+IGJyZWFrIHRoZSBmdW5jdGlvblxyXG4gICAgICAgIGlmIChNYXRoLmFicyhzdGFydENvb3Jkcy55IC0gY3VyQ29vcmRzLnkpIDwgMTApIHJldHVybjtcclxuXHJcbiAgICAgICAgZHJhZ2dpbmdFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3RvZG8tZWxlbWVudC1kcmFnZ2luZycpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgndG9kby1kcmFnZ2luZycpO1xyXG5cclxuICAgICAgICAvLyBpZiBtb3VzZSBjdXJzb3Igd2VudCBvdXQgb2Ygb2JqID0+IGJyZWFrIHRoZSBmdW5jdGlvblxyXG4gICAgICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnbGknKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAvLyBpZiBtb3VzZSBjdXJzb3IgaXMgc3RpbGwgb24gdGhlIG9iamVjdCB3ZXJlIHByZXZpb3VzbHkgY2FsY3VsYXRlZCA9PiBicmVhayB0aGUgZnVuY3Rpb25cclxuICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnbGknKSAhPT0gY3VyVGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIGN1clRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2xpJyk7XHJcbiAgICAgICAgICAgIGN1clRhcmdldEVxdWF0b3IgPSBjdXJUYXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgd2luZG93LnBhZ2VZT2Zmc2V0ICsgY3VyVGFyZ2V0Lm9mZnNldEhlaWdodCAvIDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpZiBlbGVtZW50cyBhcmUgbWF0Y2ggPT4gYnJlYWsgdGhlIGZ1bmN0aW9uXHJcbiAgICAgICAgaWYgKGRyYWdnaW5nRWxlbWVudCA9PSBjdXJUYXJnZXQpIHJldHVybjtcclxuXHJcbiAgICAgICAgLy8gaWYgb24gdG9wIC4uLiAmIGJvdHRvbVxyXG4gICAgICAgIGlmIChzdGFydENvb3Jkcy55IDwgY3VyQ29vcmRzLnkgJiYgY3VyQ29vcmRzLnkgPiBjdXJUYXJnZXRFcXVhdG9yKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZUVsZW1lbnRzKGRyYWdnaW5nRWxlbWVudCwgY3VyVGFyZ2V0LCAnZG93bicpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRDb29yZHMueSA+IGN1ckNvb3Jkcy55ICYmIGN1ckNvb3Jkcy55IDwgY3VyVGFyZ2V0RXF1YXRvcikge1xyXG4gICAgICAgICAgICBjaGFuZ2VFbGVtZW50cyhkcmFnZ2luZ0VsZW1lbnQsIGN1clRhcmdldCwgJ3VwJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdFbmQoKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZHJhZ01vdmUpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBkcmFnRW5kKTtcclxuICAgICAgICBkcmFnZ2luZ0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgndG9kby1lbGVtZW50LWRyYWdnaW5nJyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCd0b2RvLWRyYWdnaW5nJyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGlzdC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGN1clRhcmdldCA9IGRyYWdnaW5nRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2xpJyk7XHJcbiAgICAgICAgLy8gY29udGludWUgaWY6IGNsaWNrIG9uIExJLCBsZWZ0IGJ1dHRvbiwgbm90aGluZyBpcyBlZGl0aW5nIG5vd1xyXG4gICAgICAgIGlmIChkcmFnZ2luZ0VsZW1lbnQuY2xvc2VzdCgnbGknKS50YWdOYW1lICE9PSAnTEknIHx8IGUud2hpY2ggIT09IDEgfHwgZHJhZ2dpbmdFbGVtZW50LmNsb3Nlc3QoJ3VsJykuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndG9kby1saXN0LWVkaXQnKVswXSkgcmV0dXJuO1xyXG5cclxuICAgICAgICBzdGFydENvb3JkcyA9IHtcclxuICAgICAgICAgICAgeTogZS5wYWdlWVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGRyYWdNb3ZlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZHJhZ0VuZCk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgLyoqKiBPVEhFUlMgKioqL1xyXG5cclxuICAgIC8vIGRpc2FibGUgZWxlbWVudHMgc2VsZWN0aW9uIChleGNlcHQgaW5wdXQgZWxlbWVudHMpXHJcbiAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnaW5wdXQnKSkgcmV0dXJuO1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmxldCBsaXN0ID0gbmV3IFRvRG9MaXN0KHtcclxuICAgIGlkOiAndG9kby1saXN0J1xyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
